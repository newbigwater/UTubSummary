/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => UpdateRelativeLinksPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// lib/path.ts
var SEP = "/";
function dirname(path) {
  return stackToPath(pathToStack(path).slice(0, -1));
}
function relative(from, to) {
  if (!from) {
    return to;
  }
  const fromStack = pathToStack(from);
  const toStack = pathToStack(to);
  const firstDiffIdx = fromStack.findIndex((value, idx) => value != toStack[idx]);
  const resultStack = [];
  for (let i = firstDiffIdx; i < fromStack.length - 1; i++) {
    resultStack.push("..");
  }
  for (let i = firstDiffIdx; i < toStack.length; i++) {
    resultStack.push(toStack[i]);
  }
  return stackToPath(resultStack);
}
function pathToStack(path) {
  return path.split(SEP);
}
function stackToPath(stack) {
  return stack.join(SEP);
}

// main.ts
var import_fs = require("fs");
var ConfirmModal = class extends import_obsidian.Modal {
  constructor(app, content, onConfirm) {
    super(app);
    this.content = content;
    this.onConfirm = onConfirm;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h1", { text: "Update Releate Links Plugin" });
    contentEl.createEl("p", { text: this.content });
    new import_obsidian.Setting(contentEl).addButton((btn) => btn.setButtonText("Yes").setCta().onClick(() => {
      this.close();
      this.onConfirm();
    })).addButton((btn) => btn.setButtonText("No").onClick(() => {
      this.close();
    }));
  }
  onClose() {
    this.contentEl.empty();
  }
};
var UpdateRelativeLinksPlugin = class extends import_obsidian.Plugin {
  async onload() {
    const { app } = this;
    const { metadataCache, vault } = app;
    const message = "[Renewer] This command will modify all links in the entire vault (not just the current file) to relative paths, and this action cannot be undone. It is recommended that you back up the vault in advance. Please confirm whether you want to execute the command.";
    this.addCommand({
      id: "update-all-relative-links Renewer",
      name: "Update all relative links Renewer",
      callback() {
        new ConfirmModal(app, message, () => {
          const promises = vault.getMarkdownFiles().map((file) => replace(vault.adapter, file, false));
          Promise.all(promises).then((linkCounts) => {
            const updatedLinkCounts = linkCounts.filter((count) => count > 0);
            const linkCount = updatedLinkCounts.reduce((sum, count) => sum + count, 0);
            const fileCount = updatedLinkCounts.length;
            new import_obsidian.Notice(`Update ${linkCount} links in ${fileCount} file${fileCount > 1 ? "s" : ""}.`);
          }).catch((err) => {
            new import_obsidian.Notice("Update links error, see console.");
            console.error(err);
          });
        }).open();
      }
    });
    this.registerEvent(vault.on("rename", (file, oldPath) => {
      var _a;
      if (!oldPath || !file.path.toLocaleLowerCase().endsWith(".md") || ((_a = file.parent) == null ? void 0 : _a.path) === dirname(oldPath)) {
        return;
      }
      if (file instanceof import_obsidian.TFile) {
        const adapter = app.vault.adapter;
        setTimeout(() => replace(vault.adapter, file, true), 100);
      }
    }));
    async function replace(root, file, notice) {
      var _a, _b;
      const metadata = metadataCache.getFileCache(file);
      const links = [...(_a = metadata == null ? void 0 : metadata.links) != null ? _a : [], ...(_b = metadata == null ? void 0 : metadata.embeds) != null ? _b : []];
      const replacePairs = links.map(({ link, original }) => {
        var _a2;
        const linkPath = link.replace(/#.*$/, "");
        if (!linkPath) {
          return null;
        }
        const linkFile = metadataCache.getFirstLinkpathDest(linkPath, file.path);
        if (!linkFile) {
          return null;
        }
        const newLinkPath = ((_a2 = file.parent) == null ? void 0 : _a2.path) === "/" ? linkFile.path : relative(file.path, linkFile.path);
        if (linkPath === newLinkPath) {
          var bCheck = false;
          const titleIndices = findBracketIndicesOfTitle(original);
          if (titleIndices && 2 < titleIndices.closeIndex - titleIndices.openIndex) {
            const altText = original.substring(titleIndices.openIndex, titleIndices.closeIndex);
            if (altText.includes("/")) {
              bCheck = true;
              console.log("1");
            } else if (!altText.includes("|400")) {
              bCheck = true;
              console.log("2");
            }
          }
          const linkIndices = findParenthesisIndicesOfURL(original);
          if (linkIndices) {
            const url = original.substring(linkIndices.openIndex, linkIndices.closeIndex);
            if (url.includes("..")) {
              bCheck = true;
              console.log("3");
            } else if (bCheck && url.includes(".md")) {
              if (url.includes(`%`)) {
                const checkUrl = url.replace(`%20`, `_`);
                if (!checkUrl.includes(`%`)) {
                  bCheck = false;
                  console.log("-2");
                }
              }
            }
          }
          if (!bCheck) {
            console.log("PASS: " + file.name);
            return null;
          }
        }
        const newOriginal = replaceOriginal(root.getBasePath() + "/" + file.path, original, linkPath, newLinkPath);
        if (original === newOriginal) {
          return null;
        }
        return [original, newOriginal];
      }).filter((pair) => pair);
      if (!(replacePairs == null ? void 0 : replacePairs.length)) {
        return 0;
      }
      try {
        const content = await vault.read(file);
        const replacedContent = replacePairs.reduce((tmpContent, pair) => {
          if ((pair == null ? void 0 : pair.length) === 2 && pair[0] !== null && pair[1] !== null) {
            return tmpContent.replace(pair[0], pair[1]);
          }
          return tmpContent;
        }, content);
        await vault.modify(file, replacedContent);
        const msg = `Update ${replacePairs.length} links in ${file.path}.`;
        console.log(msg);
        if (notice) {
          new import_obsidian.Notice(msg);
        }
        return replacePairs.length;
      } catch (e) {
        console.error(e);
        if (notice) {
          new import_obsidian.Notice("Update links error, see console.");
        }
        throw e;
      }
    }
    function findBracketIndicesOfTitle(original) {
      const openIndex = original.indexOf("[");
      if (openIndex === -1)
        return null;
      const closeIndex = original.indexOf("](", openIndex + 1);
      if (closeIndex === -1)
        return null;
      return { openIndex, closeIndex };
    }
    function findParenthesisIndicesOfURL(str) {
      const openIndex = str.indexOf("(");
      if (openIndex === -1)
        return null;
      const closeIndex = str.indexOf(")", openIndex + 1);
      if (closeIndex === -1)
        return null;
      return { openIndex, closeIndex };
    }
    function getFileName(path) {
      const segments = path.split("/");
      return decodeURIComponent(segments.pop() || "");
    }
    function getFullDirectory(path) {
      const parts = path.split("/");
      parts.pop();
      return parts.join("/");
    }
    function getLastDirectory(path) {
      const parts = path.split("/");
      return parts.length >= 2 ? parts[parts.length - 2] : "";
    }
    function ensureDirSync(dirPath) {
      const fs2 = require("fs");
      if (!fs2.existsSync(dirPath)) {
        fs2.mkdirSync(dirPath, { recursive: true });
      }
    }
    async function copyFileAsync(src, dest) {
      try {
        await import_fs.promises.access(src);
        try {
          await import_fs.promises.copyFile(src, dest);
        } catch (copyErr) {
          new import_obsidian.Notice("-2 \uBCF5\uC0AC \uC2E4\uD328");
          console.error(copyErr);
        }
      } catch (err) {
        new import_obsidian.Notice("-1 \uC6D0\uBCF8 \uC5C6\uC74C");
        console.error(err);
      }
    }
    function replaceOriginal(filePath, original, link, newLink) {
      console.log(`replaceOriginal:original: ${original}
 - Old: ${link}
 - New: ${newLink}`);
      const titleIndices = findBracketIndicesOfTitle(original);
      if (titleIndices && 2 < titleIndices.closeIndex - titleIndices.openIndex) {
        const tmplinkIndices = findParenthesisIndicesOfURL(original);
        if (!tmplinkIndices)
          return null;
        const url = original.substring(tmplinkIndices.openIndex + 1, tmplinkIndices.closeIndex);
        if (url.includes(".md")) {
          console.log(`File Link Research Start`);
          const Title = original.substring(titleIndices.openIndex + 1, titleIndices.closeIndex);
          const newTitle = getFileName(Title);
          original = original.replace(Title, newTitle);
          console.log(`File Link Research Start
 - Old: ${Title}
 - New: ${newTitle}
 - Result: ${original}`);
        } else {
          console.log(`Img Research Start`);
          const Title = original.substring(0, titleIndices.closeIndex);
          if (Title.includes("![")) {
            const Title2 = original.substring(titleIndices.openIndex + 1, titleIndices.closeIndex);
            original = original.replace(Title2, `${getFileName(link)}|400`);
          } else {
            original = original.replace(Title, getFileName(link));
          }
        }
      } else {
        console.log(`Empty Title`);
        original = original.replace("[]", "[" + link + "|400]");
      }
      const linkIndices = findParenthesisIndicesOfURL(original);
      if (linkIndices) {
        const url = original.substring(linkIndices.openIndex + 1, linkIndices.closeIndex);
        if (url.includes("..") && !url.includes(".md")) {
          const fileDir = getFullDirectory(filePath);
          const newUrlDir = fileDir + "/" + getLastDirectory(link);
          ensureDirSync(newUrlDir);
          copyFileAsync(fileDir + "/" + link, newUrlDir + "/" + getFileName(link));
          newLink = getLastDirectory(link) + "/" + getFileName(link);
        }
        let newOriginal = replaceWithFormat(original, "(" + url + ")", "(" + newLink + ")", (s) => s.replace(/ /g, "%20"));
        if (original === newOriginal) {
          newOriginal = replaceWithFormat(original, "(" + url + ")", "(" + newLink + ")", encodeURI);
          console.log(`1 newOriginal: ${newOriginal}`);
        }
        console.log(`newOriginal: ${newOriginal}`);
        return newOriginal;
      }
      return null;
    }
    function replaceWithFormat(str, from, to, format) {
      return str.replace(format(from), format(to));
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJsaWIvcGF0aC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgTm90aWNlLCBQbHVnaW4sIFNldHRpbmcsIFRGaWxlLCBGaWxlU3lzdGVtQWRhcHRlciB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgZGlybmFtZSwgcmVsYXRpdmUgfSBmcm9tICcuL2xpYi9wYXRoJztcclxuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcyc7XHJcblxyXG5jbGFzcyBDb25maXJtTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBjb250ZW50OiBzdHJpbmc7XHJcbiAgICBvbkNvbmZpcm06ICgpID0+IHZvaWQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGNvbnRlbnQ6IHN0cmluZywgb25Db25maXJtOiAoKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgICAgICB0aGlzLm9uQ29uZmlybSA9IG9uQ29uZmlybTtcclxuICAgIH1cclxuXHJcbiAgICBvbk9wZW4oKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDEnLCB7IHRleHQ6ICdVcGRhdGUgUmVsZWF0ZSBMaW5rcyBQbHVnaW4nIH0pO1xyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgncCcsIHsgdGV4dDogdGhpcy5jb250ZW50IH0pO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4gYnRuXHJcbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnWWVzJylcclxuICAgICAgICAgICAgICAgIC5zZXRDdGEoKVxyXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ29uZmlybSgpO1xyXG4gICAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4gYnRuXHJcbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnTm8nKVxyXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuY29udGVudEVsLmVtcHR5KCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVwZGF0ZVJlbGF0aXZlTGlua3NQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gICAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgICAgIGNvbnN0IHsgYXBwIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHsgbWV0YWRhdGFDYWNoZSwgdmF1bHQgfSA9IGFwcDtcclxuXHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICdbUmVuZXdlcl0gVGhpcyBjb21tYW5kIHdpbGwgbW9kaWZ5IGFsbCBsaW5rcyBpbiB0aGUgZW50aXJlIHZhdWx0IChub3QganVzdCB0aGUgY3VycmVudCBmaWxlKSB0byByZWxhdGl2ZSBwYXRocywnXHJcbiAgICAgICAgICAgICsgJyBhbmQgdGhpcyBhY3Rpb24gY2Fubm90IGJlIHVuZG9uZS4nXHJcbiAgICAgICAgICAgICsgJyBJdCBpcyByZWNvbW1lbmRlZCB0aGF0IHlvdSBiYWNrIHVwIHRoZSB2YXVsdCBpbiBhZHZhbmNlLidcclxuICAgICAgICAgICAgKyAnIFBsZWFzZSBjb25maXJtIHdoZXRoZXIgeW91IHdhbnQgdG8gZXhlY3V0ZSB0aGUgY29tbWFuZC4nO1xyXG5cclxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xyXG4gICAgICAgICAgICBpZDogJ3VwZGF0ZS1hbGwtcmVsYXRpdmUtbGlua3MgUmVuZXdlcicsXHJcbiAgICAgICAgICAgIG5hbWU6ICdVcGRhdGUgYWxsIHJlbGF0aXZlIGxpbmtzIFJlbmV3ZXInLFxyXG4gICAgICAgICAgICBjYWxsYmFjaygpIHtcclxuICAgICAgICAgICAgICAgIG5ldyBDb25maXJtTW9kYWwoYXBwLCBtZXNzYWdlLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSB2YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkubWFwKGZpbGUgPT4gcmVwbGFjZSh2YXVsdC5hZGFwdGVyIGFzIEZpbGVTeXN0ZW1BZGFwdGVyLCBmaWxlLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihsaW5rQ291bnRzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZExpbmtDb3VudHMgPSBsaW5rQ291bnRzLmZpbHRlcihjb3VudCA9PiBjb3VudCA+IDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlua0NvdW50ID0gdXBkYXRlZExpbmtDb3VudHMucmVkdWNlKChzdW0sIGNvdW50KSA9PiBzdW0gKyBjb3VudCwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVDb3VudCA9IHVwZGF0ZWRMaW5rQ291bnRzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYFVwZGF0ZSAke2xpbmtDb3VudH0gbGlua3MgaW4gJHtmaWxlQ291bnR9IGZpbGUke2ZpbGVDb3VudCA+IDEgPyAncycgOiAnJ30uYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnVXBkYXRlIGxpbmtzIGVycm9yLCBzZWUgY29uc29sZS4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSkub3BlbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh2YXVsdC5vbigncmVuYW1lJywgKGZpbGUsIG9sZFBhdGgpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFvbGRQYXRoXHJcbiAgICAgICAgICAgICAgICB8fCAhZmlsZS5wYXRoLnRvTG9jYWxlTG93ZXJDYXNlKCkuZW5kc1dpdGgoJy5tZCcpXHJcbiAgICAgICAgICAgICAgICB8fCBmaWxlLnBhcmVudD8ucGF0aCA9PT0gZGlybmFtZShvbGRQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gYXBwLnZhdWx0LmFkYXB0ZXI7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcGxhY2UodmF1bHQuYWRhcHRlciBhcyBGaWxlU3lzdGVtQWRhcHRlciwgZmlsZSwgdHJ1ZSksIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJlcGxhY2Uocm9vdDogRmlsZVN5c3RlbUFkYXB0ZXIsIGZpbGU6IFRGaWxlLCBub3RpY2U6IGJvb2xlYW4pIHtcclxuICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBtZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgICAgICAgICAgY29uc3QgbGlua3MgPSBbLi4uKG1ldGFkYXRhPy5saW5rcyA/PyBbXSksIC4uLihtZXRhZGF0YT8uZW1iZWRzID8/IFtdKV07XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VQYWlycyA9IGxpbmtzLm1hcCgoeyBsaW5rLCBvcmlnaW5hbCB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL2lmICghb3JpZ2luYWwuc3RhcnRzV2l0aCgnIVsnKSkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlua1BhdGggPSBsaW5rLnJlcGxhY2UoLyMuKiQvLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWxpbmtQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlua0ZpbGUgPSBtZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGxpbmtQYXRoLCBmaWxlLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFsaW5rRmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0xpbmtQYXRoID0gZmlsZS5wYXJlbnQ/LnBhdGggPT09ICcvJyA/IGxpbmtGaWxlLnBhdGggOiByZWxhdGl2ZShmaWxlLnBhdGgsIGxpbmtGaWxlLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpbmtQYXRoID09PSBuZXdMaW5rUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiQ2hlY2sgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGVJbmRpY2VzID0gZmluZEJyYWNrZXRJbmRpY2VzT2ZUaXRsZShvcmlnaW5hbClcclxuICAgICAgICAgICAgICAgICAgICBpZih0aXRsZUluZGljZXMgJiYgMiA8ICh0aXRsZUluZGljZXMuY2xvc2VJbmRleCAtIHRpdGxlSW5kaWNlcy5vcGVuSW5kZXgpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWx0VGV4dCA9IG9yaWdpbmFsLnN1YnN0cmluZyh0aXRsZUluZGljZXMub3BlbkluZGV4ICwgdGl0bGVJbmRpY2VzLmNsb3NlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFsdFRleHQuaW5jbHVkZXMoJy8nKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJzEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKCFhbHRUZXh0LmluY2x1ZGVzKCd8NDAwJykpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYkNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtJbmRpY2VzID0gZmluZFBhcmVudGhlc2lzSW5kaWNlc09mVVJMKG9yaWdpbmFsKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGxpbmtJbmRpY2VzKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJsID0gb3JpZ2luYWwuc3Vic3RyaW5nKGxpbmtJbmRpY2VzLm9wZW5JbmRleCAsIGxpbmtJbmRpY2VzLmNsb3NlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHVybC5pbmNsdWRlcygnLi4nKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJzMnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGJDaGVjayAmJiB1cmwuaW5jbHVkZXMoJy5tZCcpKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHVybC5pbmNsdWRlcyhgJWApKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrVXJsID0gdXJsLnJlcGxhY2UoYCUyMGAsIGBfYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWNoZWNrVXJsLmluY2x1ZGVzKGAlYCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiQ2hlY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJy0yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZighYkNoZWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1BBU1M6ICcgKyBmaWxlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdPcmlnaW5hbCA9IHJlcGxhY2VPcmlnaW5hbChyb290LmdldEJhc2VQYXRoKCkgKyBcIi9cIiArIGZpbGUucGF0aCwgb3JpZ2luYWwsIGxpbmtQYXRoLCBuZXdMaW5rUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoZmlsZS5uYW1lICsgJ1xcbi0gb3JpZ2luYWw6ICcgKyBvcmlnaW5hbCArICdcXG4tIG5ld09yaWdpbmFsOiAnICsgbmV3T3JpZ2luYWwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsID09PSBuZXdPcmlnaW5hbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtvcmlnaW5hbCwgbmV3T3JpZ2luYWxdO1xyXG4gICAgICAgICAgICB9KS5maWx0ZXIocGFpciA9PiBwYWlyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghcmVwbGFjZVBhaXJzPy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHZhdWx0LnJlYWQoZmlsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZWRDb250ZW50ID0gcmVwbGFjZVBhaXJzLnJlZHVjZSgodG1wQ29udGVudCwgcGFpcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhaXI/Lmxlbmd0aCA9PT0gMiAmJiBwYWlyWzBdICE9PSBudWxsICYmIHBhaXJbMV0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG1wQ29udGVudC5yZXBsYWNlKHBhaXJbMF0sIHBhaXJbMV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRtcENvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICB9LCBjb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB2YXVsdC5tb2RpZnkoZmlsZSwgcmVwbGFjZWRDb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBgVXBkYXRlICR7cmVwbGFjZVBhaXJzLmxlbmd0aH0gbGlua3MgaW4gJHtmaWxlLnBhdGh9LmA7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vdGljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UobXNnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXBsYWNlUGFpcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vdGljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1VwZGF0ZSBsaW5rcyBlcnJvciwgc2VlIGNvbnNvbGUuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kQnJhY2tldEluZGljZXNPZlRpdGxlKG9yaWdpbmFsOiBzdHJpbmcpOiB7IG9wZW5JbmRleDogbnVtYmVyOyBjbG9zZUluZGV4OiBudW1iZXIgfSB8IG51bGwge1xyXG4gICAgICAgICAgICBjb25zdCBvcGVuSW5kZXggPSBvcmlnaW5hbC5pbmRleE9mKCdbJylcclxuICAgICAgICAgICAgaWYgKG9wZW5JbmRleCA9PT0gLTEpIHJldHVybiBudWxsXHJcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlSW5kZXggPSBvcmlnaW5hbC5pbmRleE9mKCddKCcsIG9wZW5JbmRleCArIDEpXHJcbiAgICAgICAgICAgIGlmIChjbG9zZUluZGV4ID09PSAtMSkgcmV0dXJuIG51bGxcclxuICAgICAgICAgICAgcmV0dXJuIHsgb3BlbkluZGV4LCBjbG9zZUluZGV4IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRQYXJlbnRoZXNpc0luZGljZXNPZlVSTChzdHI6IHN0cmluZyk6IHsgb3BlbkluZGV4OiBudW1iZXI7IGNsb3NlSW5kZXg6IG51bWJlciB9IHwgbnVsbCB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZW5JbmRleCA9IHN0ci5pbmRleE9mKCcoJylcclxuICAgICAgICAgICAgaWYgKG9wZW5JbmRleCA9PT0gLTEpIHJldHVybiBudWxsXHJcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlSW5kZXggPSBzdHIuaW5kZXhPZignKScsIG9wZW5JbmRleCArIDEpXHJcbiAgICAgICAgICAgIGlmIChjbG9zZUluZGV4ID09PSAtMSkgcmV0dXJuIG51bGxcclxuICAgICAgICAgICAgcmV0dXJuIHsgb3BlbkluZGV4LCBjbG9zZUluZGV4IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZpbGVOYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHNlZ21lbnRzLnBvcCgpIHx8ICcnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZ1bGxEaXJlY3RvcnkocGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICBwYXJ0cy5wb3AoKTsgICAgICAgICAgICAgICAgLy8gXHVCOUM4XHVDOUMwXHVCOUM5IFx1QzY5NFx1QzE4QyhcdUQzMENcdUM3N0NcdUJBODUpIFx1QzgxQ1x1QUM3MFxyXG4gICAgICAgICAgICByZXR1cm4gcGFydHMuam9pbignLycpOyAgICAgLy8gXHVCMDk4XHVCQTM4XHVDOUMwIFx1QzY5NFx1QzE4Q1x1Qjk3QyAnLydcdUI4NUMgXHVBQ0IwXHVENTY5XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExhc3REaXJlY3RvcnkocGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAvLyBcdUQzMENcdUM3N0NcdUJBODVcdUM3NzQgXHVDNTQ0XHVCMkNDIFx1QjlDOFx1QzlDMFx1QjlDOSBcdUQzRjRcdUIzNTQgXHVDNzc4XHVCMzcxXHVDMkE0XHVCMjk0IGxlbmd0aC0yXHJcbiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5sZW5ndGggPj0gMiA/IHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdIDogJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGVuc3VyZURpclN5bmMoZGlyUGF0aDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnZW5zdXJlRGlyU3luYzogJyArIGRpclBhdGgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xyXG4gICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnXHVDMEREXHVDMTMxXHVENTY5XHVCMkM4XHVCMkU0LicpO1xyXG4gICAgICAgICAgICAgICAgZnMubWtkaXJTeW5jKGRpclBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCdcdUMwRERcdUMxMzEgXHVDNjQ0XHVCOENDLicpO1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoZnMuZXhpc3RzU3luYyhkaXJQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgbmV3IE5vdGljZSgnXHVDODc0XHVDN0FDXHVENTY5XHVCMkM4XHVCMkU0Jyk7XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgIC8vZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vICAgIG5ldyBOb3RpY2UoJ1x1QzBERFx1QzEzMSBcdUMyRTRcdUQzMjguJyk7XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2Vsc2V7XHJcbiAgICAgICAgICAgIC8vICAgIG5ldyBOb3RpY2UoJ1x1Qzg3NFx1QzdBQ1x1RDU2OVx1QjJDOFx1QjJFNC4nKTtcclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhc3luYyBmdW5jdGlvbiBjb3B5RmlsZUFzeW5jKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGZzLmFjY2VzcyhzcmMpOyAgLy8gXHVDNkQwXHVCQ0Y4IFx1RDMwQ1x1Qzc3QyBcdUM4MTFcdUFERkMgXHVENjU1XHVDNzc4XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZzLmNvcHlGaWxlKHNyYywgZGVzdCk7ICAvLyBcdTI3MDUgXHVDNjJDXHVCQzE0XHVCOTc4IFx1QkNGNVx1QzBBQyBcdUJDMjlcdUMyRERcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGNvcHlFcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCctMiBcdUJDRjVcdUMwQUMgXHVDMkU0XHVEMzI4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihjb3B5RXJyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCctMSBcdUM2RDBcdUJDRjggXHVDNUM2XHVDNzRDJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlcGxhY2VPcmlnaW5hbChmaWxlUGF0aDogc3RyaW5nLCBvcmlnaW5hbDogc3RyaW5nLCBsaW5rOiBzdHJpbmcsIG5ld0xpbms6IHN0cmluZykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgcmVwbGFjZU9yaWdpbmFsOm9yaWdpbmFsOiAke29yaWdpbmFsfVxcbiAtIE9sZDogJHtsaW5rfVxcbiAtIE5ldzogJHtuZXdMaW5rfWApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdGl0bGVJbmRpY2VzID0gZmluZEJyYWNrZXRJbmRpY2VzT2ZUaXRsZShvcmlnaW5hbClcclxuICAgICAgICAgICAgaWYodGl0bGVJbmRpY2VzICYmIDIgPCAodGl0bGVJbmRpY2VzLmNsb3NlSW5kZXggLSB0aXRsZUluZGljZXMub3BlbkluZGV4KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG1wbGlua0luZGljZXMgPSBmaW5kUGFyZW50aGVzaXNJbmRpY2VzT2ZVUkwob3JpZ2luYWwpXHJcbiAgICAgICAgICAgICAgICBpZighdG1wbGlua0luZGljZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gb3JpZ2luYWwuc3Vic3RyaW5nKHRtcGxpbmtJbmRpY2VzLm9wZW5JbmRleCArIDEsIHRtcGxpbmtJbmRpY2VzLmNsb3NlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICBpZih1cmwuaW5jbHVkZXMoJy5tZCcpKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRmlsZSBMaW5rIFJlc2VhcmNoIFN0YXJ0YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgVGl0bGUgPSBvcmlnaW5hbC5zdWJzdHJpbmcodGl0bGVJbmRpY2VzLm9wZW5JbmRleCArIDEgLCB0aXRsZUluZGljZXMuY2xvc2VJbmRleClcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdUaXRsZSA9IGdldEZpbGVOYW1lKFRpdGxlKVxyXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsID0gb3JpZ2luYWwucmVwbGFjZShUaXRsZSwgbmV3VGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGaWxlIExpbmsgUmVzZWFyY2ggU3RhcnRcXG4gLSBPbGQ6ICR7VGl0bGV9XFxuIC0gTmV3OiAke25ld1RpdGxlfVxcbiAtIFJlc3VsdDogJHtvcmlnaW5hbH1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEltZyBSZXNlYXJjaCBTdGFydGApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFRpdGxlID0gb3JpZ2luYWwuc3Vic3RyaW5nKDAgLCB0aXRsZUluZGljZXMuY2xvc2VJbmRleClcclxuICAgICAgICAgICAgICAgICAgICBpZihUaXRsZS5pbmNsdWRlcyhcIiFbXCIpKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgVGl0bGUgPSBvcmlnaW5hbC5zdWJzdHJpbmcodGl0bGVJbmRpY2VzLm9wZW5JbmRleCArIDEgLCB0aXRsZUluZGljZXMuY2xvc2VJbmRleClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCdUaXRsZTE6ICcgKyBUaXRsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsID0gb3JpZ2luYWwucmVwbGFjZShUaXRsZSwgYCR7Z2V0RmlsZU5hbWUobGluayl9fDQwMGApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoJ1RpdGxlMSBSZXN1bHQ6ICcgKyBvcmlnaW5hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnVGl0bGUyOiAnICsgVGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCA9IG9yaWdpbmFsLnJlcGxhY2UoVGl0bGUsIGdldEZpbGVOYW1lKGxpbmspKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCdUaXRsZTIgUmVzdWx0OiAnICsgb3JpZ2luYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFbXB0eSBUaXRsZWApO1xyXG4gICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCdUaXRsZTM6ICcgKyBvcmlnaW5hbCk7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbCA9IG9yaWdpbmFsLnJlcGxhY2UoXCJbXVwiLCBcIltcIitsaW5rK1wifDQwMF1cIik7XHJcbiAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoJ1RpdGxlMyBSZXN1bHQ6ICcgKyBvcmlnaW5hbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmtJbmRpY2VzID0gZmluZFBhcmVudGhlc2lzSW5kaWNlc09mVVJMKG9yaWdpbmFsKVxyXG4gICAgICAgICAgICBpZihsaW5rSW5kaWNlcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gb3JpZ2luYWwuc3Vic3RyaW5nKGxpbmtJbmRpY2VzLm9wZW5JbmRleCArIDEsIGxpbmtJbmRpY2VzLmNsb3NlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICBpZih1cmwuaW5jbHVkZXMoJy4uJykgJiYgIXVybC5pbmNsdWRlcygnLm1kJykpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZURpciA9IGdldEZ1bGxEaXJlY3RvcnkoZmlsZVBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnZmlsZURpcjogJyArIGZpbGVEaXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1VybERpciA9IGZpbGVEaXIgKyBcIi9cIiArIGdldExhc3REaXJlY3RvcnkobGluayk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCduZXdVcmxEaXI6ICcgKyBuZXdVcmxEaXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBlbnN1cmVEaXJTeW5jKG5ld1VybERpcilcclxuICAgICAgICAgICAgICAgICAgICBjb3B5RmlsZUFzeW5jKGZpbGVEaXIrXCIvXCIrbGluaywgbmV3VXJsRGlyK1wiL1wiK2dldEZpbGVOYW1lKGxpbmspKVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0xpbmsgPSBnZXRMYXN0RGlyZWN0b3J5KGxpbmspICsgXCIvXCIgKyBnZXRGaWxlTmFtZShsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoJ3JlcGxhY2VPcmlnaW5hbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnZmlsZURpcjogJyArIGZpbGVEaXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbmV3IE5vdGljZSgnZmlsZVBhdGg6ICcgKyBmaWxlUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9uZXcgTm90aWNlKCdvcmlnaW5hbDogJyArIG9yaWdpbmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoJ2xpbms6ICcgKyBsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAvL25ldyBOb3RpY2UoJ25ld0xpbms6ICcgKyBuZXdMaW5rKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3T3JpZ2luYWwgPSByZXBsYWNlV2l0aEZvcm1hdChvcmlnaW5hbCwgXCIoXCIrdXJsK1wiKVwiLCBcIihcIituZXdMaW5rK1wiKVwiLCBzID0+IHMucmVwbGFjZSgvIC9nLCAnJTIwJykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsID09PSBuZXdPcmlnaW5hbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld09yaWdpbmFsID0gcmVwbGFjZVdpdGhGb3JtYXQob3JpZ2luYWwsIFwiKFwiK3VybCtcIilcIiwgXCIoXCIrbmV3TGluaytcIilcIiwgZW5jb2RlVVJJKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgMSBuZXdPcmlnaW5hbDogJHtuZXdPcmlnaW5hbH1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vaWYgKG9yaWdpbmFsID09PSBuZXdPcmlnaW5hbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgbmV3T3JpZ2luYWwgPSBvcmlnaW5hbC5yZXBsYWNlKC9eKCE/XFxbLio/XFxdKS4qJC8sIGAkMSgke2VuY29kZVVSSShuZXdMaW5rKX0pYClcclxuICAgICAgICAgICAgICAgIC8vICAgIGNvbnNvbGUubG9nKGAyIG5ld09yaWdpbmFsOiAke25ld09yaWdpbmFsfWApO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgbmV3T3JpZ2luYWw6ICR7bmV3T3JpZ2luYWx9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3T3JpZ2luYWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXBsYWNlV2l0aEZvcm1hdChzdHI6IHN0cmluZywgZnJvbTogc3RyaW5nLCB0bzogc3RyaW5nLCBmb3JtYXQ6IChzOiBzdHJpbmcpID0+IHN0cmluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoZm9ybWF0KGZyb20pLCBmb3JtYXQodG8pKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwgImNvbnN0IFNFUCA9ICcvJztcclxuXHJcbmZ1bmN0aW9uIGRpcm5hbWUocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBzdGFja1RvUGF0aChwYXRoVG9TdGFjayhwYXRoKS5zbGljZSgwLCAtMSkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZWxhdGl2ZShmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFmcm9tKSB7XHJcbiAgICAgICAgcmV0dXJuIHRvO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZyb21TdGFjayA9IHBhdGhUb1N0YWNrKGZyb20pO1xyXG4gICAgY29uc3QgdG9TdGFjayA9IHBhdGhUb1N0YWNrKHRvKTtcclxuXHJcbiAgICBjb25zdCBmaXJzdERpZmZJZHggPSBmcm9tU3RhY2suZmluZEluZGV4KCh2YWx1ZSwgaWR4KSA9PiB2YWx1ZSAhPSB0b1N0YWNrW2lkeF0pO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdFN0YWNrOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSBmaXJzdERpZmZJZHg7IGkgPCBmcm9tU3RhY2subGVuZ3RoIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgcmVzdWx0U3RhY2sucHVzaCgnLi4nKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gZmlyc3REaWZmSWR4OyBpIDwgdG9TdGFjay5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHJlc3VsdFN0YWNrLnB1c2godG9TdGFja1tpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHN0YWNrVG9QYXRoKHJlc3VsdFN0YWNrKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGF0aFRvU3RhY2socGF0aDogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgcmV0dXJuIHBhdGguc3BsaXQoU0VQKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc3RhY2tUb1BhdGgoc3RhY2s6IHN0cmluZ1tdKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBzdGFjay5qb2luKFNFUCk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IGRpcm5hbWUsIHJlbGF0aXZlIH1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUE4RTs7O0FDQTlFLElBQU0sTUFBTTtBQUVaLFNBQVMsUUFBUSxNQUFzQjtBQUNuQyxTQUFPLFlBQVksWUFBWSxJQUFJLEVBQUUsTUFBTSxHQUFHLEVBQUUsQ0FBQztBQUNyRDtBQUVBLFNBQVMsU0FBUyxNQUFjLElBQW9CO0FBQ2hELE1BQUksQ0FBQyxNQUFNO0FBQ1AsV0FBTztBQUFBLEVBQ1g7QUFFQSxRQUFNLFlBQVksWUFBWSxJQUFJO0FBQ2xDLFFBQU0sVUFBVSxZQUFZLEVBQUU7QUFFOUIsUUFBTSxlQUFlLFVBQVUsVUFBVSxDQUFDLE9BQU8sUUFBUSxTQUFTLFFBQVEsSUFBSTtBQUU5RSxRQUFNLGNBQXdCLENBQUM7QUFFL0IsV0FBUyxJQUFJLGNBQWMsSUFBSSxVQUFVLFNBQVMsR0FBRyxLQUFLO0FBQ3RELGdCQUFZLEtBQUssSUFBSTtBQUFBLEVBQ3pCO0FBRUEsV0FBUyxJQUFJLGNBQWMsSUFBSSxRQUFRLFFBQVEsS0FBSztBQUNoRCxnQkFBWSxLQUFLLFFBQVEsRUFBRTtBQUFBLEVBQy9CO0FBRUEsU0FBTyxZQUFZLFdBQVc7QUFDbEM7QUFFQSxTQUFTLFlBQVksTUFBd0I7QUFDekMsU0FBTyxLQUFLLE1BQU0sR0FBRztBQUN6QjtBQUVBLFNBQVMsWUFBWSxPQUF5QjtBQUMxQyxTQUFPLE1BQU0s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
